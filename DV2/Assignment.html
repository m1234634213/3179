<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Australian International and Domestic Travel</title>
  <link rel="stylesheet" href="styler.css">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <header>
    <h1>Australian International and Domestic Travel</h1>
    <div class="cloud cloud1">
      <img src="05cd33059a006bf49006097af4ccba98-plane-in-flight-by-vexels.png" alt="Plane" />
    </div>
  </header>

  <!-- Global year slider -->
  <div id="sliderContainer">
    <label for="yearSlider"><strong>Select Year:</strong></label>
    <input type="range" id="yearSlider" min="2000" max="2025" step="1" value="2010">
    <span id="yearLabel">2010</span>
  </div>

  <!-- Scaled Dashboard -->
  <main class="dashboard scaled-container">

    <!-- Row 1: Global Flight Trends -->
    <div class="row">
      <div class="story-box">
        <h2>Global Flight Trends</h2>
        <p>…existing text…</p>
      </div>
      <div class="chart-box">
        <div id="mainChart" class="rotating-globe"></div>
      </div>
    </div>

    <!-- Row 2: Domestic Airlines -->
    <div class="row">
      <div class="story-box">
        <p>…existing text…</p>
      </div>
      <div class="chart-box">
        <h2>Domestic Airlines</h2>
        <div id="domesticAirlines"></div>
      </div>
    </div>

    <!-- Row 3: Domestic Passenger Trends (full width) -->
    <div class="row full-width">
      <div class="chart-box">
        <h2>Domestic Passenger Trends</h2>
        <div id="domestic"></div>
      </div>
    </div>

    <!-- Row 4: International Routes -->
    <div class="row">
      <div class="story-box">
        <h2>International Routes</h2>
        <p>…existing text…</p>
      </div>
      <div class="chart-box">
        <div id="cityInt"></div>
      </div>
    </div>

    <!-- Row 5: Emissions Map (full width) -->
    <div class="row full-width">
      <div class="chart-box">
        <h2>Emissions Map</h2>
        <div id="emissionsMap"></div>
      </div>
    </div>

    <!-- Row 6: Gas Trends (full width) -->
    <div class="row full-width">
      <div class="chart-box">
        <h2>Gas Trends</h2>
        <div id="gas"></div>
      </div>
    </div>

    <!-- Row 7: Global Trends -->
    <div class="row">
      <div class="story-box">
        <h2>Global Trends</h2>
        <p>…existing text…</p>
      </div>
      <div class="chart-box">
        <div id="week9Homework" class="rotating-globe"></div>
      </div>
    </div>

  </main>

  <script>
    const charts = [
      { id: "mainChart", file: "world_map.vg.json" },
      { id: "domesticAirlines", file: "domestic_airlines.vg.json" },
      { id: "domestic", file: "Domestic.vg.json" },
      { id: "emissionsMap", file: "Emissions_map.vg.json" },
      { id: "cityInt", file: "city_int.vg.json" },
      { id: "gas", file: "gas.vg.json" },
      { id: "week9Homework", file: "week_9_homework.vg.json" },
    ];

    let chartViews = {};
    const yearSlider = document.getElementById("yearSlider");
    const yearLabel = document.getElementById("yearLabel");

    function updateCharts(year) {
      yearLabel.textContent = year;
      Object.values(chartViews).forEach(view => {
        if (view.signalNames().includes("selectedYear")) {
          view.signal("selectedYear", year).run();
        }
      });
    }

    charts.forEach(chart => {
      fetch(chart.file)
        .then(r => r.json())
        .then(spec => {
          if (!["mainChart", "week9Homework"].includes(chart.id)) {
            spec.params = spec.params || [];
            spec.params.push({
              name: "selectedYear",
              value: parseInt(yearSlider.value),
              bind: false
            });
          }

          spec.autosize = { type: "fit", contains: "padding" };
          if (["gas", "emissionsMap", "domestic", "cityInt"].includes(chart.id)) {
            spec.width = "container";
          }

          vegaEmbed('#' + chart.id, spec, { actions: false })
            .then(res => { chartViews[chart.id] = res.view; })
            .catch(err => console.error(`Error embedding chart ${chart.id}:`, err));
        })
        .catch(err => console.error(`Error loading ${chart.file}:`, err));
    });

    yearSlider.addEventListener("input", e => updateCharts(parseInt(e.target.value)));

    // Rotating globes
    vegaEmbed('#week9Homework', 'week_9_homework.vg.json', { actions: false })
      .then(res => {
        let globeView = res.view;
        let angle = 0;
        setInterval(() => {
          angle += 0.2;
          globeView.signal("rotate0", angle).run();
        }, 50);
      });

    vegaEmbed('#mainChart', 'world_map.vg.json', { actions: false })
      .then(res => {
        let mainView = res.view;
        let angle = 0;
        setInterval(() => {
          angle += 0.6;
          mainView.signal("rotLon", angle).run();
        }, 50);
      });
  </script>
</body>
</html>
