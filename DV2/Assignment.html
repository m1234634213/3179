<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Australian International and Domestic Travel</title>
  <link rel="stylesheet" href="styler.css">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <header>
    <h1>Australian International and Domestic Travel</h1>
    <div class="cloud cloud1">
      <div class="light"></div>
      <img src="05cd33059a006bf49006097af4ccba98-plane-in-flight-by-vexels.png" alt="Plane" />
    </div>
  </header>

  <!-- Global year slider -->
  <div id="sliderContainer">
    <label for="yearSlider"><strong>Select Year:</strong></label>
    <input type="range" id="yearSlider" min="2000" max="2025" step="1" value="2010">
    <span id="yearLabel">2010</span>
  </div>

  <!-- Dashboard with scaling -->
  <div class="scaled-container">
    <main class="dashboard">

      <!-- Row 1 -->
      <div class="row">
        <div class="story-box">
          <h2>Global Flight Trends</h2>
          <p>The global international routes map provides a broad view of how Australia connects with the rest of the world...</p>
        </div>
        <div class="chart-box">
          <div id="mainChart" class="rotating-globe"></div>
        </div>
      </div>

      <!-- Row 2 -->
      <div class="row">
        <div class="chart-box">
          <h2>Domestic Airlines</h2>
          <div id="domesticAirlines"></div>
        </div>
        <div class="story-box">
          <p>The story of Australian domestic air travel begins with the well-established giants of the sky...</p>
        </div>
      </div>

      <!-- Row 3 (Full width) -->
      <div class="row full-width">
        <div class="chart-box">
          <h2>Emissions Map</h2>
          <div id="emissionsMap"></div>
        </div>
      </div>

      <!-- Row 4 (Full width) -->
      <div class="row full-width">
        <div class="chart-box">
          <h2>Gas Trends</h2>
          <div id="gas"></div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // Dynamic scaling of dashboard
    const container = document.querySelector('.scaled-container');

    function scaleDashboard() {
      const screenWidth = window.innerWidth;
      const maxContentWidth = 1400; // same as max-width in CSS
      let scale = 1;

      if (screenWidth < maxContentWidth) {
        scale = screenWidth / maxContentWidth; // scale to fit screen
      }

      container.style.transform = `scale(${scale})`;
      container.style.transformOrigin = 'top center';
    }

    // Initial scaling
    scaleDashboard();

    // Rescale on window resize
    window.addEventListener('resize', scaleDashboard);

    // Vega chart setup
    const charts = [
      { id: "mainChart", file: "world_map.vg.json" },
      { id: "domesticAirlines", file: "domestic_airlines.vg.json" },
      { id: "emissionsMap", file: "Emissions_map.vg.json" },
      { id: "gas", file: "gas.vg.json" }
    ];

    let chartViews = {};
    const yearSlider = document.getElementById("yearSlider");
    const yearLabel = document.getElementById("yearLabel");

    function updateCharts(year) {
      yearLabel.textContent = year;
      Object.values(chartViews).forEach(view => {
        if (view.signalNames().includes("selectedYear")) {
          view.signal("selectedYear", year).run();
        }
      });
    }

    charts.forEach(chart => {
      fetch(chart.file)
        .then(r => r.json())
        .then(spec => {
          if (chart.id !== "mainChart") {
            spec.params = spec.params || [];
            spec.params.push({ name: "selectedYear", value: parseInt(yearSlider.value), bind: false });
          }

          vegaEmbed('#' + chart.id, spec, { actions: false })
            .then(res => { chartViews[chart.id] = res.view; })
            .catch(err => console.error(`Error embedding chart ${chart.id}:`, err));
        })
        .catch(err => console.error(`Error loading ${chart.file}:`, err));
    });

    yearSlider.addEventListener("input", e => updateCharts(parseInt(e.target.value)));
  </script>
</body>
</html>
