<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Visualisation 2</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <header>
    <h1>Data Visualisation 2</h1>
    <div class="cloud cloud1">
      <div class="light"></div>
      <img src="05cd33059a006bf49006097af4ccba98-plane-in-flight-by-vexels.png" alt="Plane"/>
    </div>
  </header>

  <!-- Global year slider -->
  <div id="sliderContainer">
    <label for="yearSlider"><strong>Select Year:</strong></label>
    <input type="range" id="yearSlider" min="2000" max="2025" step="1" value="2010">
    <span id="yearLabel">2010</span>
  </div>

  <!-- Layout -->
  <main class="dashboard">
    <div class="side-column">
      <div class="chart-box">
        <h2>Domestic Airlines of Choice</h2>
        <div id="domesticAirlines"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Domestic</h2>
        <div id="domestic"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Emissions Map</h2>
        <div id="emissionsMap"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
    </div>

    <div class="main-column">
      <div class="chart-box main-chart">
        <h2>Global Globe</h2>
        <div id="mainChart"></div>
      </div>
    </div>

    <div class="side-column">
      <div class="chart-box">
        <h2>International Airline of Choice</h2>
        <div id="cityInt"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Engine Efficiency</h2>
        <div id="gas"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Week 9 Homework</h2>
        <div id="week9Homework"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
    </div>
  </main>

  <script>
    const charts = [
      { id: "mainChart", file: "global.vg.json" },
      { id: "domesticAirlines", file: "domestic_airlines.vg.json" },
      { id: "domestic", file: "domestic.vg.json" },
      { id: "emissionsMap", file: "emissions_map.vg.json" }, // check spelling
      { id: "cityInt", file: "city_int.vg.json" },
      { id: "gas", file: "gas.vg.json" },
      { id: "week9Homework", file: "week_9_homework.vg.json" },
    ];

    const chartViews = {};
    const yearSlider = document.getElementById("yearSlider");
    const yearLabel = document.getElementById("yearLabel");

    function loadCharts() {
      charts.forEach(chart => {
        fetch(chart.file)
          .then(res => {
            if (!res.ok) throw new Error(`Cannot load ${chart.file}`);
            return res.json();
          })
          .then(spec => vegaEmbed('#' + chart.id, spec, { actions: false }))
          .then(embed => {
            chartViews[chart.id] = embed.view;

            // Initialize selectedYear if the chart supports it
            if (embed.view.signalNames().includes("selectedYear")) {
              embed.view.signal("selectedYear", parseInt(yearSlider.value)).run();
            }
          })
          .catch(err => console.error(err));
      });
    }

    function updateCharts(year) {
      yearLabel.textContent = year;
      Object.values(chartViews).forEach(view => {
        if (view.signalNames().includes("selectedYear")) {
          view.signal("selectedYear", year).run();
        }
      });
    }

    yearSlider.addEventListener("input", e => updateCharts(parseInt(e.target.value)));

    // Load charts on page load
    loadCharts();
  </script>
</body>
</html>
