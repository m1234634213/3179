<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Visualisation 2</title>
  <link rel="stylesheet" href="styler.css">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <header>
    <h1>Data Visualisation 2</h1>
    <!-- Animated plane -->
    <div class="cloud">
      <div class="light"></div>
      <img src="05cd33059a006bf49006097af4ccba98-plane-in-flight-by-vexels.png" alt="Plane"/>
    </div>
  </header>

  <!-- Global year slider -->
  <div id="yearSelectorContainer">
  <label for="yearSelector"><strong>Select Year:</strong></label>
  <select id="yearSelector">
    <!-- List years dynamically or manually -->
    <option value="2000">2000</option>
    <option value="2001">2001</option>
    <option value="2002">2002</option>
    ...
    <option value="2025" selected>2010</option>
  </select>
</div>

  <!-- Layout -->
  <main class="dashboard">
    <div class="side-column">
      <div class="chart-box">
        <h2>Domestic Airlines</h2>
        <div id="domesticAirlines"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Domestic</h2>
        <div id="domestic"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Emissions Map</h2>
        <div id="emissionsMap"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
    </div>

    <div class="main-column">
      <div class="chart-box main-chart">
        <h2>Global Globe</h2>
        <div id="mainChart"></div>
      </div>
    </div>

    <div class="side-column">
      <div class="chart-box">
        <h2>City International</h2>
        <div id="cityInt"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Gas</h2>
        <div id="gas"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
      <div class="chart-box">
        <h2>Week 9 Homework</h2>
        <div id="week9Homework"></div>
        <p class="notes">Notes: (Fill later)</p>
      </div>
    </div>
  </main>

  <script>
    const charts = [
    {id: "mainChart", file: "globe.vg.json"},
    {id: "domesticAirlines", file: "domestic_airlines.vg.json"},
    {id: "domestic", file: "Domestic.vg.json"},
    {id: "emissionsMap", file: "Emissions_map.vg.json"},
    {id: "cityInt", file: "city_int.vg.json"},
    {id: "gas", file: "gas.vg.json"},
    {id: "week9Homework", file: "week_9_homework.vg.json"},
  ];

    let chartViews = {};
    const yearSelector = document.getElementById("yearSelector");
const yearLabel = document.getElementById("yearLabel");

function updateCharts(year) {
  yearLabel.textContent = year;
  Object.keys(chartViews).forEach(chartId => {
    const view = chartViews[chartId];
    if (!view) return;

    // Clamp domesticAirlines to 2010
    const chartYear = chartId === "domesticAirlines" ? Math.max(year, 2010) : year;

    // Update signal if exists, otherwise filter data dynamically
    if (view.signal("yearSignal")) {
      view.signal("yearSignal", chartYear).run();
    } else {
      // For charts without a yearSignal, filter their data
      const dataName = view._runtime.data?.[0]?.name || 'source_0';
      const originalData = view.data(dataName)._values;
      const filtered = originalData.filter(d => d.Year <= chartYear);
      view.change(dataName, vega.changeset().remove(() => true).insert(filtered)).run();
    }
  });
}

// Run update when dropdown changes
yearSelector.addEventListener("change", e => updateCharts(parseInt(e.target.value)));
  </script>
</body>
</html>
