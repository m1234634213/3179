<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualisation 2</title>
    <link rel="stylesheet" href="trial.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
    <header>
        <h1>Data Visualisation 2</h1>
        <div class="cloud cloud1">
            <div class="light"></div>
            <img src="05cd33059a006bf49006097af4ccba98-plane-in-flight-by-vexels.png" alt="Plane" />
        </div>
    </header>

    <!-- Global year slider -->
    <div id="sliderContainer">
        <label for="yearSlider"><strong>Select Year:</strong></label>
        <input type="range" id="yearSlider" min="2000" max="2025" step="1" value="2010">
        <span id="yearLabel">2010</span>
    </div>

    <!-- Layout -->
    <main class="dashboard">

        <!-- Row 1: Text Left, Chart Right -->
        <div class="row">
            <div class="story-box">
                <h2>Global Flight Trends</h2>
                <p>The global aviation network shows how Australia connects with major cities worldwide. Key hubs
                    dominate traffic, while new routes emerge over time.</p>
            </div>
            <div class="chart-box main-chart">
                <div id="mainChart"></div>
            </div>
        </div>

        <!-- Row 2: Chart Left, Text Right -->
        <div class="row">
            <div class="chart-box">
                <h2>Domestic Airlines</h2>
                <div id="domesticAirlines"></div>
            </div>
            <div class="story-box">
                <p>Domestic airlines in Australia have evolved, with Qantas and Virgin dominating. Smaller airlines
                    disappeared, while newcomers like Bonza entered the market.</p>
            </div>
        </div>

        <!-- Row 3: Full-width Chart -->
        <div class="row">
            <div class="chart-box full-width">
                <h2>Domestic Passenger Trends</h2>
                <div id="domestic"></div>
            </div>
        </div>

        <!-- Row 4: Text Left, Chart Right -->
        <div class="row">
            <div class="story-box">
                <h2>International Routes</h2>
                <p>International city connectivity demonstrates growth in outbound and inbound travel from Australia.
                    Some destinations rise in popularity, while others decline.</p>
            </div>
            <div class="chart-box">
                <div id="cityInt"></div>
            </div>
        </div>

        <!-- Row 5: Chart Left, Text Right -->
        <div class="row">
            <div class="chart-box">
                <h2>Emissions Map</h2>
                <div id="emissionsMap"></div>
            </div>
            <div class="story-box">
                <p>The emissions map highlights environmental impact by airline route. Patterns show which routes
                    contribute most to aviation emissions over time.</p>
            </div>
        </div>

        <!-- Row 6: Full-width Chart -->
        <div class="row">
            <div class="chart-box full-width">
                <h2>Gas Trends</h2>
                <div id="gas"></div>
            </div>
        </div>

        <!-- Row 7: Text Left, Chart Right -->
        <div class="row">
            <div class="story-box">
                <h2>Week 9 Homework</h2>
                <p>This interactive globe demonstrates flight paths and rotation effects, offering a visual way to
                    explore aviation networks and trends.</p>
            </div>
            <div class="chart-box main-chart">
                <div id="week9Homework" class="rotating-globe"></div>
            </div>
        </div>

    </main>


    <script>
        const charts = [
            { id: "mainChart", file: "world_map.vg.json" },
            { id: "domesticAirlines", file: "domestic_airlines.vg.json" },
            { id: "domestic", file: "Domestic.vg.json" },
            { id: "emissionsMap", file: "Emissions_map.vg.json" },
            { id: "cityInt", file: "city_int.vg.json" },
            { id: "gas", file: "gas.vg.json" },
            { id: "week9Homework", file: "week_9_homework.vg.json" },
        ];

        let chartViews = {};
        const yearSlider = document.getElementById("yearSlider");
        const yearLabel = document.getElementById("yearLabel");

        function updateCharts(year) {
            yearLabel.textContent = year;
            Object.values(chartViews).forEach(view => {
                view.signal("selectedYear", year).run();
            });
        }

        charts.forEach(chart => {
            fetch(chart.file)
                .then(r => r.json())
                .then(spec => {
                    spec.params = spec.params || [];
                    spec.params.push({ name: "selectedYear", value: parseInt(yearSlider.value), bind: false });
                    vegaEmbed('#' + chart.id, spec, { actions: false }).then(res => {
                        chartViews[chart.id] = res.view;
                    });
                });
        });

        yearSlider.addEventListener("input", e => updateCharts(parseInt(e.target.value)));
        let globeView;
        vegaEmbed('#week9Homework', 'week_9_homework.vg.json', { actions: false })
            .then(res => {
                globeView = res.view;

                // Auto-rotation
                let angle = 0;
                const rotationSpeed = 0.2; // degrees per frame
                setInterval(() => {
                    angle += rotationSpeed;
                    globeView.signal("rotate0", angle).run();
                }, 50); // update every 50ms
            });
    </script>
</body>

</html>